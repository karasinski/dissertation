\chapter{Modeling the Effects of Feedback}
\label{chapter:modeling}

\section{Introduction}
\textbf{\color{red} This chapter discusses the last of my PhD work.
    The work is approximately 90\% complete, but the final results and writeup are not yet complete.}

\subsection{Motivation}
The second Aim of this dissertation is to develop a model of the human pilot which includes the effects of concurrent bandwidth feedback.
The model presented here extends Hess' Structural Model of the human pilot.
The Structural Model has been extremely successful in predicting human performance through a variety of system dynamics and can predict how performance changes during a pilot's adaptation to changing dynamics.
Hess has developed adaptive logic for the human pilot in a pursuit task which triggers when the pilot notices that vehicle dynamics have changed~\citep{hess_modeling_2009}.
This logic is based off several criteria, which ``must be predicated upon information available to the human [and] the postadapated pilot models must follow the dictates of the crossover model of the human pilot~\citep{hess_modeling_2009}.''
The primary result of the adaptive logic is to increase the resulting crossover frequency of the pilot, effectively making them more responsive, which could be interpreted as more focused on the task.

\begin{figure}[tb]
    \begin{center}
        \includegraphics[width=0.8\linewidth]{figures/Modeling/Screen_Shot_2018-08-09_at_4_15_24_PM.png}
        \caption[Hess' model of the adaptive human pilot]{Hess' model of the adaptive human pilot, from~\citet{hess_modeling_2009}.}
        \label{figure:hesspursuit}
    \end{center}
\end{figure}

While this model of the adaptive pilot has been successful in predicting changes in performance for a well trained subject, it does not consider how a pilot would behave when they are still in the early stages of training.
The modified model presented here includes two major changes to Hess' current model:
\begin{itemize}
    \item The adaptation logic is changed to focus on concurrent bandwidth feedback
    \item The timescale of the adaptation is significantly longer
\end{itemize}

Here, the adaptive logic to triggers when the pilot is receiving concurrent bandwidth feedback, rather than when a change in system dynamics occurs.
This will requires the addition of a feedback loop onto the Structural Model which triggers when the bandwidth feedback is activated.
This loop is based around the $K_e$ gain, which is the primary way of setting the crossover frequency in the Structural Model.
This change implies that the subjects in our experiments do their primary learning when they are receiving qualitative feedback that their current level of aggressiveness is not sufficient to complete the task.

While there must be a separate loop that adjusts the crossover frequency as learning progresses over the course of several hours, the change in performance we see when subjects use the concurrent bandwidth feedback happens relatively rapidly, within a few minutes.
This is reflected in the delta of performance between subjects in the different groups of our SAFER experiment, even on the first trial, see Figure~\ref{figure:saferdistance}.
This relates to the second required change, the amount of required adaptation time.
Hess' model requires that pilots adapt within a very short time period, on the order of 5 seconds~\citep{weir_model_1966}.
The results of our experiment with SAFER and the three-axis tracking task also suggest relatively short adaptation times, though they are on the order of a few minutes, again see Figure~\ref{figure:saferdistance}.

% We want to use models to identify some aspect(s) which cause the pilot to perform better.

\begin{figure}[t]
    \centering
    \begin{subfigure}[b]{\textwidth}
        \centering
        \includegraphics[width=0.8\textwidth]{figures/structural_model/structural_model.pdf}
        \caption[The complete Structural Model]{The complete Structural Model, from~\citet{hess_unified_1997}.}
        \label{fig:structuralmodel}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{\textwidth}
        \centering
        \includegraphics[width=0.8\textwidth]{figures/structural_model_reduced/structural_model.pdf}
        \caption[The reduced structural model used in this analysis]{The reduced structural model used in this analysis.}
        \label{fig:structuralmodelreduced}
    \end{subfigure}
    \caption[The Structural Model of the Human Pilot]{The Structural Model of the Human Pilot.}
    \label{fig:structuralmodels}
\end{figure}

\section{Method}

\subsection{The Piloting Task}

\begin{figure}[b]
    \centering
    \includegraphics[width=0.8\linewidth]{figures/Aircraft/image1.png}
    \caption[The interface]{The interface that participants were presented with during the experiment, showing the flight task on the right with deviations from nominal in pitch, roll, and altitude, and the secondary, two-choice, task on the right.}
    \label{fig:display}
\end{figure}

Training operators to perform complex manual control tasks is expensive and time consuming, and poorly trained operators can cause catastrophic failures.
The use of concurrent feedback techniques has been shown to improve performance and reduce training times, but has not previously been evaluated for complex, real-world tasks such as flying aircraft.
In the experiment (fully described in Chapter~\ref{chapter:aircraftfeedback}), thirty participants were evenly split into two groups and tasked with flying a simulated Boeing 747 aircraft in three control modes of increasing degrees of freedom and functional complexity.
In order of increasing degrees of freedom and functional complexity, these three control modes were:
\begin{itemize}
    \item[\textbf{P}] Pitch only (low complexity)
    \item[\textbf{PR}] Pitch and Roll (moderate complexity)
    \item[\textbf{PRA}] Pitch, Roll and Altitude (significant complexity)
\end{itemize}
The control group controlled simulated aircraft motion with visual guidance for pitch, roll, and altitude provided by traditional flight instruments.
The feedback group received additional visual concurrent feedback for each controlled degree of freedom.
For both groups, performance measurements were evaluated to determine the effects of the feedback on subject learning rate and maximum skill level.
To assess short-term retention of learned skill for the feedback group, the concurrent feedback was removed, and performance was again evaluated.

Each participant completed a total of 36 trials; 12 in each of the three control modes.
Each trial had a duration of 82 seconds, and participants self-initiated the trial by activating a trigger on the joystick.
The complete results of this experiment can be seen in Chapter~\ref{chapter:aircraftfeedback}.

The two groups of participants are: control and feedback, and the interface that participants saw during the experiment is available in Figure~\ref{fig:display}.
When the vehicle was well controlled (small errors in the controlled degrees of freedom), the interface was the same for participants in both groups.
Depending on the control mode the the participant was completing, however, participants in the feedback group experienced concurrent bandwidth feedback on various elements of the attitude indicator and altimeter.
This feedback was indicated by changing the element from the default yellow color to a red color when the error deviated outside of a predetermined bandiwdth.
Pitch feedback was provided on the central pitch indicator when the pitch was three or more degrees from zero, roll feedback was provided on the attitude indicator's ``wings'' when the roll was three or more degrees from zero, and attitude feedback was provided on the altimeter text box when the altitude was 30 feet or more off the nominal altitude of 1000 feet.
After the 9th trial, subjects in the feedback group no longer experienced feedback, and the interfaces for the control and feedback groups were the same.
This was done in order to investigate how well the subjects could retain their performance benefit.

The resulting root-mean-square error for each group of participants by trial is presented in Figure~\ref{fig:prmse}.
Both groups of participants had a relatively high initial RMSE which was reduced through repeated training on the task.
Participants in the feedback group, however, performed significantly better than those in the control group and learned the task much faster.
Additionally, subjects in the feedback group were able to maintain their improved performance when the feedback was removed, and actually show a slight increase in performance when this occurs.

\begin{figure}[t]
    \centering
    \includegraphics[width=0.8\linewidth]{figures/Modeling/prms_arx.png}
    \caption[Pitch root-mean-square error]{Pitch root-mean-square error. Feedback was removed from subjects in the feedback group after the 9th trial in order to investigate retention.}
    \label{fig:prmse}
\end{figure}

\subsection{ARX Model Identification}
% \subsection{AutoRegressive Models with eXogenous Variables (ARX)}
% A time-domain autoregressive exogenous (ARX) identification technique was used to estimate pilot transfer functions and the estimated pilot/vehicle open-loop transfer functions were evaluated to determine the evolution of the crossover frequency for each control loop throughout training.
% The Hess Structural Model of the pilot is also investigated, which “describe the underlying structure which contributes to human pilot dynamics.'' The Structural Model is of interest for interpreting the effects of concurrent feedback as it incorporates multiple sensory channels and models of visual acuity and the time-varying human pilot.
% Results indicate that participants in the feedback group had a significantly lower root-mean-square error and higher crossover frequency than those in the control group, indicating better performance.
% The ARX identification technique provided a consistently high variance accounted for (VAF), indicating that it can identify transfer functions representing a variety of operators at various levels of training.
% These results are more pronounced for modes with increased functional complexity and persisted in retention testing when the feedback was removed, indicating that participants were not reliant on the feedback.

% We have a ``black box'' model which can give us a coarse understanding of the pilot.
% This is the ARX technique which Hess has used, \textit{gettf1}.
% We also have the control theory based model, the Structural Model, which Hess has used for several decades.
% This model is more interesting because it has multiple parameters which could be responsible for the observed change in performance.

This is pretty simple, we simply pass the input/output data into gettf1 and observe the characteristics of the resulting transfer function.
We can also combine the estimated operator transfer function with the vehicle dynamics to observe the overall system characteristics, such as the crossover frequency.

An autoregressive technique to identify a transfer function from an input/output time sequence pair was previously developed by Hess et al.~\citet{hess_modeling_2002}.
Using this technique, called \textit{gettf1}, we identified transfer functions representing pilot models for the data trials from our experiment.
The resulting pilot models can be compared with the experimental data from which they are generated in order to determine the goodness of fit.
Two goodness of fit metrics are available: the variance accounted for (VAF) and the root-mean-square error between the model output and participant data.
The VAF is calculated by
\begin{equation}
    \mbox{VAF} = \left( 1 - \dfrac{\sum{|u - u_{sim}|^2}} {\sum{u^2}} \right) \times \mbox{100\%}
\end{equation}
where $u$ is the participant's command input to the vehicle's elevators, and $u_{sim}$ is the model's simulated input.

\begin{figure}[t]
    \centering
    \begin{subfigure}[b]{\textwidth}
        \centering
        \includegraphics[width=0.8\textwidth]{figures/Modeling/model_output.png}
        \caption[Comparison between estimated transfer function model and experimental data]{Comparison between estimated transfer function model and experimental data.}
        \label{fig:comparison}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{\textwidth}
        \centering
        \includegraphics[width=0.8\textwidth]{figures/Modeling/YpYc_204.png}
        \caption[Combined pilot/vehicle open-loop bode diagram]{Combined pilot/vehicle open-loop bode diagram showing the standard crossover model characteristics.}
        \label{fig:bode}
    \end{subfigure}
    \caption[Example results from using the estimated pilot models from \textit{gettf1}]{Example results from using the estimated pilot models from \textit{gettf1}.}
    %    \label{fig:goodnessoffit}
\end{figure}

The VAF of the feedback group's models immediately jumps up after the first trial to an average of $\approx.75$, indicating a good fit.
The control groups VAF increases more slowly, to a value of approximately $\approx.68$.
An increased VAF indicates that the pilot is behaving in a more linear fashion, and these results suggest that the concurrent feedback is able to immediately assist participants to this end.
The RMSE between the simulated and actual data is similar between groups and trends slightly up during training.
Visual inspection of the experimental and simulated data also shows very good agreement, see Figure~\ref{fig:comparison}.

By combining these pilot models with the system dynamics the crossover frequency (Figure~\ref{fig:bode}) and gain and phase margins can be found.
The crossover model has long been used as the standard model for human control tasks, where the crossover frequency represents ``how hard'' the pilot is working~\citet{mcruer_dynamic_1957}.
The results of these parameters reflect what was found in the pitch RMSE performance analysis.
Subjects in the feedback group immediately show increased crossover frequency and decreased phase and gain margins.
These results are sustained during retention, and again show an immediate increase/decrease when the feedback is removed.

\begin{figure}
    \centering
    \includegraphics[width=0.8\linewidth]{figures/Modeling/wc_arx.png}
    \caption[Crossover frequency (ARX)]{Crossover frequency predicted by the ARX technique.}
    \label{fig:arx_crossover}
\end{figure}

Mixed models were used to calculate the significance of factors in our analysis due to the presence of performance outliers which were removed from the analysis.
The Satterthwaite method was used to calculate the adjusted degrees of freedom using the lmerTest package in R~\citet{RN53}.
When significant effects were observed, post hoc comparisons using the Tukey Honest Significance Difference (HSD) test were performed and considered significant at the $p < .05$ level, and the Satterthwaite method was again used to calculate the degrees of freedom.
Only 7 of the 1080 total trials (30 subjects with 36 trials per subject) were removed.
These trials were extreme performance outliers, and including these trials does not change the primary results of the study.

A three-factor (Group, Mode, and Trial) mixed model with two repeated measures (Mode and Trial) was run on the pitch crossover frequency.
There were significant main factors of group $(F(1, 28.00) = 4.9, p = 0.036)$, mode $(F(2, 55.62) = 17.1, p < .001)$, and trial $(F(11, 306.23) = 39.4, p < .001)$.
There were also significant interaction effects between group and trial $(F(11, 306.23) = 2.0, p = 0.025)$ and between mode and trial $(F(22, 610.08) = 2.8, p < .001)$.
Despite the presence of interaction effects that result from participants learning the task (as indicated by the trial factor), the main effects can still be interpreted.
A Tukey test showed that the participants in the groups differed significantly, with the participants in the feedback group outperforming those in the control group $(M = 1.25, 1.56,$ respectively, $SE = 0.10)$.
An additional Tukey test showed that the participants' crossover frequency between the modes differed significantly, with the largest crossover frequency in the P mode, followed by the PR mode, and finally the lowest in the PRA mode $(M = 1.53, 1.38, 1.31$ respectively, $SE = 0.07)$.
This same analysis was completed on the roll crossover frequency, with similar results.
There were significant main factors of group $(F(1, 27.82) = 8.2, p < 0.01)$, mode $(F(1, 25.49) = 23.2, p < 0.001)$, and trial $(F(11, 292.40) = 16.3, p < .001)$.
Tukey tests showed that the participants' crossover frequency between the groups and the modes each differed significantly, with the participants in the feedback group again outperforming those in the control group $(M = 0.55, 0.89,$ respectively, $SE = 0.08)$, and crossover frequency was best in the PR mode followed by the PRA mode $(M = 0.77, 0.67,$ respectively, $SE = 0.06)$.
A two-factor (Group and Trial) mixed model with one repeated measure (Trial) was run on the altitude crossover frequency.
There were significant main factors of group $(F(1, 27.92) = 4.4, p = 0.046)$ and trial $(F(11, 301.95) = 18.3, p < .001)$.
Tukey tests showed that the participants' crossover frequency between the groups differed significantly, with the participants in the feedback group again outperforming those in the control group $(M = 0.98, 1.29,$ respectively, $SE = 0.11)$, and the trial effect showing learning throughout the experiment for both groups.

\subsection{Structural Model Parameter Identification}
% \subsection{The Structural Model}
This is more complicated, as there are many parameters to identify which interact nonlinearly, and the fit function has many local maximums.

\section{Results}

\subsection{Model Parameterization}
\begin{equation}
    Y_{NM} = \frac{\omega^2_{NM}}{s^2 + 2 \zeta_{NM} \omega_{NM} s + \omega^2_{NM}}
\end{equation}

\begin{equation}
    Y_{FS} \approx 1
\end{equation}

\begin{equation} \label{eq:ypf}
    Y_{PF} = \frac{K}{s+a}
\end{equation}
Equation~\ref{eq:ypf} is chosen to satisfy $Y_{PF} \propto s Y_c (s)$.

\subsection{Parameter Value Selection}

\begin{equation}
    K_{\dot{e}} = \epsilon = K_{\dot{m}} = K_{\ddot{m}} = 0
\end{equation}

\begin{equation}
    S_1 = S_2 = S_3 = \enspace \downarrow
\end{equation}

% \begin{equation}
%     \omega_{NM} = 10 \mbox{ rad/s}, \quad \zeta_{NM} = 0.707
% \end{equation}

The flight dynamics for this task represent a Boeing 747 in Flight Condition 2, and resultant elevator to pitch dynamics take the form~\citep{heffley1972aircraft}:
\begin{equation}
    Y_c = \frac{0.5716 (s+0.5535) (s+0.03952)}{(s^2 + 0.006158s + 0.01512) (s^2 + 1.12s + 0.8006)}
\end{equation}

\subsubsection{Value Identification Technique}
A brute force parameter search was used to identify the value of the remaining parameters.
Each combination of the parameters $K_e, \tau_0, K, a$, and $\omega_{NM}$ were enumerated over and simulated in Simulink using the same flight model and disturbance profiles as the participants experienced in the experiment.
The resulting 102,600 simulations were compared to each trial to identify the set of parameter values resulting in the smallest VAF.

Once this initial global best fit was identified, the parameters were further tuned in MATLAB using ``fmincon'' to find the minimum of the constrained nonlinear multivariable function.
The constraints for the solver were the bounds of the global brute force search, though, in general, the optimizer did not result in large parameter changes from the initial values.

\begin{align}
    K_e         & = [1, 2, 3, \ldots, 30]         \\
    \tau_0      & = [.20, .25, .30] s             \\
    K           & = [1.0, 1.5, 2.0, \ldots, 10.0] \\
    a           & = [.0, .25, .50, \ldots, 3.0]   \\
    \omega_{NM} & = [7, 8, 9, 10, 11, 12]         \\
    \zeta_{NM}  & = [0.7]                         \\
\end{align}

\begin{figure}[t]
    \centering
    \centering
    \includegraphics[width=0.8\linewidth]{figures/Modeling/wc_group.png}
    \label{fig:sm_crossover}
    \caption[Crossover frequency (Structural Model)]{Crossover frequency predicted by the Structural Model parameter identification.}
\end{figure}

\begin{figure}[t]
    \centering
    \centering
    \includegraphics[width=0.8\linewidth]{figures/Modeling/ke_group.png}
    \label{fig:ke_group}
    \caption[$K_e$ is greater for subjects exposed to feedback]{$K_e$ is greater for subjects exposed to feedback.}
\end{figure}

\begin{figure}[t]
    \centering
    \centering
    \includegraphics[width=0.8\linewidth]{figures/Modeling/f_v_kfd.png}
    \label{fig:feedback_kfd}
    \caption[Feedback exposure correlates with $\dot{K_f}$]{Feedback exposure correlates with $\dot{K_f}$, which confirms that the accumulation of exposure to feedback drives $K_f$.}
\end{figure}

% Structural Model Parameter Identification Technique

% 	Run (Parallel)ModelGenerator.m in MATLAB to generate many model outputs.
% 	Run ExperimentMatcher.py in Python to identify the global optimum best initial set of parameters.
% 	Run ModelOptimizer.m in MATLAB to iterate on the initial guess to identify an optimal set of parameters.
% 	Run ModelAnalysis.r in R to generate the statistics.
% 	Run OptimalModelPlots.py in Python to make the plots.

% Ke
% Type III Analysis of Variance Table with Satterthwaite's method
%       Sum Sq Mean Sq NumDF DenDF F value    Pr(>F)
% group  113.8  113.80     1    27  7.2654   0.01195 *
% trial 1493.7  135.79    11   308  8.6693 2.201e-13 ***
% ---
% Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

% tdel
% Type III Analysis of Variance Table with Satterthwaite's method
%         Sum Sq   Mean Sq NumDF DenDF F value Pr(>F)
% group 0.000176 0.0001760     1    27  0.0171 0.8968
% trial 0.068712 0.0062466    11   308  0.6081 0.8217

% Ypf
% Type III Analysis of Variance Table with Satterthwaite's method
%       Sum Sq Mean Sq NumDF DenDF F value Pr(>F)
% group 12.032  12.032     1    27  1.6509 0.2097
% trial 82.819   7.529    11   308  1.0331 0.4168

% a
% Type III Analysis of Variance Table with Satterthwaite's method
%        Sum Sq Mean Sq NumDF DenDF F value   Pr(>F)
% group  0.0031 0.00314     1    27  0.0068 0.934953
% trial 13.6429 1.24026    11   308  2.6798 0.002657 **
% ---
% Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

% Wnm
% Type III Analysis of Variance Table with Satterthwaite's method
%        Sum Sq Mean Sq NumDF DenDF F value Pr(>F)
% group   0.477  0.4768     1    27  0.0487 0.8270
% trial 130.831 11.8937    11   308  1.2141 0.2764

% Zetanm
% Type III Analysis of Variance Table with Satterthwaite's method
%          Sum Sq    Mean Sq NumDF DenDF F value  Pr(>F)
% group 0.0000331 0.00003309     1    27  0.1937 0.66338
% trial 0.0035074 0.00031886    11   308  1.8665 0.04314 *
% ---
% Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1


% All variables can be treated as constants with the exception of  K_e, which changes with both Trial and Group.
% tdel	Ypf	a	Wnm	Zetanm
% 0.238±0.006	5.927±0.163	1.301±0.041	7.768±0.185	0.707±0.001

% Model K_e as Exponential Fit: K_e=A*e^(-B*Trial)+C

% 	A	B	C
% Control	-7.34466243	0.37349137	12.40429001
% Feedback	-67.32338104	1.99463577	17.40238421

\section{Discussion}
% \begin{figure*}
%     \centering
%     \includegraphics[width=6in]{figures/Modeling/crossover_measures.pdf}
%     \caption{The crossover frequency of the estimated pilot/vehicle open-loop transfer functions for each group, trial, and control task.
%         The dashed line indicates where the feedback was removed from participants in the feedback group.
%         Error bars are the standard error of the mean.}
%     \label{figure:crossover_frequency_all}
% \end{figure*}
